global
    log stdout format raw local0

defaults
    log     global
    mode    http
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend http_in
    bind *:80
    redirect scheme https code 301

frontend https_in
    bind *:443 ssl crt /etc/haproxy/certs/fullchain.pem crt-key /etc/haproxy/certs/privkey.pem
    http-request set-header X-Forwarded-Proto https
    http-request set-header X-Forwarded-For %[src]
    http-request set-header X-Forwarded-Host %[req.hdr(host)]
    default_backend rest_service

backend rest_service
    option httpchk GET /health
    server rest rest:8888 check inter 5s fall 3 rise 2
